# Настройка PM2 для Cyberpunk Tarot Cards

Этот документ описывает как запустить приложение через PM2 в production режиме.

## Быстрый старт

Запустите автоматический скрипт установки:

```bash
./setup-pm2.sh
```

Скрипт автоматически:
- ✅ Проверит установку Node.js и npm
- ✅ Установит PM2 (если не установлен)
- ✅ Установит serve (статический сервер)
- ✅ Создаст конфигурацию PM2
- ✅ Обновит package.json
- ✅ Соберёт production build
- ✅ Запустит приложение через PM2

## После установки

Приложение будет доступно на: **http://localhost:4444**

### Управление приложением

```bash
# Просмотр статуса
npm run pm2:status

# Просмотр логов
npm run pm2:logs

# Перезапуск
npm run pm2:restart

# Остановка
npm run pm2:stop

# Удаление из PM2
npm run pm2:delete
```

### Прямые команды PM2

```bash
# Статус всех приложений
pm2 status

# Логи
pm2 logs cyberpunk-tarot

# Мониторинг
pm2 monit

# Перезапуск
pm2 restart cyberpunk-tarot

# Остановка
pm2 stop cyberpunk-tarot

# Удаление
pm2 delete cyberpunk-tarot
```

## Конфигурация

Конфигурация PM2 находится в `ecosystem.config.js`:

- **Порт**: 4444
- **Автоперезапуск**: включен
- **Максимальная память**: 1GB
- **Логи**: `./logs/`

## Автозапуск при старте системы

Чтобы приложение автоматически запускалось при старте системы:

```bash
# Сгенерировать startup скрипт
pm2 startup

# Сохранить текущие процессы
pm2 save
```

## Обновление приложения

После внесения изменений в код:

```bash
# Пересобрать
npm run build

# Перезапустить PM2
npm run pm2:restart
```

## Логи

Логи сохраняются в папке `logs/`:
- `err.log` - ошибки
- `out.log` - стандартный вывод
- `combined.log` - все логи

## Устранение проблем

### PM2 не найден
```bash
sudo npm install -g pm2
```

### Порт 4444 занят
Измените порт в `ecosystem.config.js`:
```javascript
args: 'serve build -l 3000', // Замените 4444 на другой порт
```

### Приложение не запускается
Проверьте логи:
```bash
npm run pm2:logs
```
